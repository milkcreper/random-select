<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ©ãƒ³ãƒ€ãƒ ã‚¿ã‚¹ã‚¯å‰²ã‚Šå½“ã¦ï¼ˆStep Bï¼‰</title>
<style>
body {
  font-family: sans-serif;
  margin: 20px;
}

textarea, input {
  width: 100%;
  margin-top: 5px;
}

button {
  margin-top: 8px;
  padding: 6px 12px;
}

.task-item {
  display: flex;
  align-items: center;
  gap: 6px;
}

.task-list {
  margin-top: 10px;
}

.groupA { color: red; }
.groupB { color: blue; }

.result {
  white-space: pre-line;
  margin-top: 15px;
}
</style>
</head>
<body>

<h1>ãƒ©ãƒ³ãƒ€ãƒ ã‚¿ã‚¹ã‚¯å‰²ã‚Šå½“ã¦ï¼ˆStep Bï¼‰</h1>

<h2>â‘  åå‰å…¥åŠ›ï¼ˆæ”¹è¡ŒåŒºåˆ‡ã‚Šãƒ»æœ€å¤§10äººï¼‰</h2>
<textarea id="names" rows="5"></textarea>

<h2>â‘¡ ã‚¿ã‚¹ã‚¯ç®¡ç†</h2>
<input type="text" id="newTask" placeholder="æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›">
<button onclick="addTask()">ã‚¿ã‚¹ã‚¯è¿½åŠ </button>
<div class="task-list" id="taskList"></div>

<h2>â‘¢ å®Ÿè¡Œè¨­å®š</h2>
<label>
  <input type="checkbox" id="taskOn" checked>
  ã‚¿ã‚¹ã‚¯ã‚’ä»˜ä¸ã™ã‚‹
</label><br>

<button onclick="run()">å®Ÿè¡Œ</button>
<button onclick="reroll()">ğŸ” ã‚¿ã‚¹ã‚¯å†æŠ½é¸</button>

<div class="result" id="result"></div>

<script>
// ===== ã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿ =====
let tasks = [
  { text: "å‰é€²ã‚­ãƒ¼å¤–ã™", enabled: true },
  { text: "ADSç¦æ­¢", enabled: true },
  { text: "ãƒ˜ãƒ“ãƒ¼ã‚¢ãƒ¼ãƒãƒ¼ç¦æ­¢", enabled: false }
];

// ===== çŠ¶æ…‹ä¿æŒ =====
let lastGroupA = [];
let lastGroupB = [];
let lastTaskOn = true;

// ===== å…±é€š =====
function shuffle(arr) {
  return arr.slice().sort(() => Math.random() - 0.5);
}

// ===== ã‚¿ã‚¹ã‚¯UI =====
function renderTasks() {
  const list = document.getElementById("taskList");
  list.innerHTML = "";
  tasks.forEach((task, i) => {
    const div = document.createElement("div");
    div.className = "task-item";

    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.checked = task.enabled;
    cb.onchange = () => tasks[i].enabled = cb.checked;

    const span = document.createElement("span");
    span.textContent = task.text;

    div.appendChild(cb);
    div.appendChild(span);
    list.appendChild(div);
  });
}

function addTask() {
  const input = document.getElementById("newTask");
  if (!input.value.trim()) return;
  tasks.push({ text: input.value.trim(), enabled: true });
  input.value = "";
  renderTasks();
}

// ===== å®Ÿè¡Œ =====
function run() {
  const names = document.getElementById("names").value
    .split("\n").map(n => n.trim()).filter(Boolean);

  if (names.length === 0 || names.length > 10) {
    alert("åå‰ã¯1ã€œ10äººã§å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  lastTaskOn = document.getElementById("taskOn").checked;

  const shuffled = shuffle(names);
  lastGroupA = shuffled.slice(0, 5);
  lastGroupB = shuffled.slice(5, 10);

  assignTasks();
}

// ===== å†æŠ½é¸ =====
function reroll() {
  if (lastGroupA.length === 0 && lastGroupB.length === 0) {
    alert("å…ˆã«å®Ÿè¡Œã—ã¦ãã ã•ã„");
    return;
  }
  assignTasks();
}

// ===== ã‚¿ã‚¹ã‚¯å‰²ã‚Šå½“ã¦ =====
function assignTasks() {
  const activeTasks = shuffle(
    tasks.filter(t => t.enabled).map(t => t.text)
  );

  if (lastTaskOn && activeTasks.length < lastGroupA.length + lastGroupB.length) {
    alert("æœ‰åŠ¹ãªã‚¿ã‚¹ã‚¯æ•°ãŒè¶³ã‚Šã¾ã›ã‚“");
    return;
  }

  let index = 0;
  let html = "";

  html += `<div class="groupA">ã€ã‚°ãƒ«ãƒ¼ãƒ—Aã€‘\n`;
  lastGroupA.forEach(name => {
    html += name;
    if (lastTaskOn) html += " ï¼š " + activeTasks[index++];
    html += "\n";
  });
  html += `</div>\n`;

  html += `<div class="groupB">ã€ã‚°ãƒ«ãƒ¼ãƒ—Bã€‘\n`;
  lastGroupB.forEach(name => {
    html += name;
    if (lastTaskOn) html += " ï¼š " + activeTasks[index++];
    html += "\n";
  });
  html += `</div>`;

  document.getElementById("result").innerHTML = html;
}

// åˆæœŸæç”»
renderTasks();
</script>

</body>
</html>
